{"code":"import { __decorate } from \"tslib\";\nimport { LitElement, html, css } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\nimport { commonStyle } from '../../styles';\nimport { localize } from '../../../localize/localize';\nimport { EArmModes } from '../../types';\nimport { fetchAreas, fetchSensors, saveArea } from '../../data/websockets';\nimport { handleError } from '../../helpers';\nimport { SubscribeMixin } from '../../subscribe-mixin';\nimport { EArmModeIcons } from '../../const';\nimport '../../components/time-slider';\nimport '../../components/effortlesshome-select';\nimport '../../components/effortlesshome-collapsible';\nimport { exportPath } from '../../common/navigation';\nlet AlarmModeCard = class AlarmModeCard extends SubscribeMixin(LitElement) {\n    hassSubscribe() {\n        this._fetchData();\n        return [\n            this.hass.connection.subscribeMessage(() => this._fetchData(), {\n                type: 'effortlesshome_config_updated',\n            }),\n        ];\n    }\n    async _fetchData() {\n        if (!this.hass) {\n            return;\n        }\n        this.areas = await fetchAreas(this.hass);\n        this.sensors = await fetchSensors(this.hass);\n    }\n    async firstUpdated() {\n        await this._fetchData();\n        this.selectedArea = Object.keys(this.areas)[0];\n        this.data = Object.assign({}, this.areas[this.selectedArea].modes);\n    }\n    render() {\n        if (!this.data)\n            return html ``;\n        return html `\n      <ha-card>\n        <div class=\"card-header\">\n          <div class=\"name\">\n            ${localize('panels.general.cards.modes.title', this.hass.language)}\n          </div>\n\n          ${Object.keys(this.areas).length > 1\n            ? html `\n                <effortlesshome-select\n                  .items=${Object.values(this.areas).map(e => Object({ value: e.area_id, name: e.name }))}\n                  value=${this.selectedArea}\n                  label=${this.hass.localize('ui.components.area-picker.area')}\n                  @value-changed=${(ev) => this.selectArea(ev.target.value)}\n                ></effortlesshome-select>\n              `\n            : ''}\n        </div>\n        <div class=\"card-content\">\n          ${localize('panels.general.cards.modes.description', this.hass.language)}\n        </div>\n\n        <effortlesshome-collapsible-group>\n          ${Object.entries(EArmModes).map(([k, mode]) => {\n            var _a;\n            return html `\n                <effortlesshome-collapsible-item>\n                  <effortlesshome-collapsible-header>\n                    <ha-icon slot=\"icon\" icon=\"${EArmModeIcons[k]}\"></ha-icon>\n                    <span slot=\"title\">\n                      ${this.hass.localize(`component.alarm_control_panel.entity_component._.state.${mode}`)}\n                    </span>\n                    <span slot=\"description\">\n                      ${((_a = this.data[mode]) === null || _a === void 0 ? void 0 : _a.enabled)\n                ? html `\n                            ${localize('common.enabled', this.hass.language)},\n                            <a href=\"${exportPath('sensors', { filter: { area: this.selectedArea, mode: mode } })}\">\n                              ${localize('panels.general.cards.modes.number_sensors_active', this.hass.language, 'number', this.getSensorsByMode(mode))}\n                            </a>\n                          `\n                : localize('common.disabled', this.hass.language)}\n                    </span>\n                  </effortlesshome-collapsible-header>\n                  <effortlesshome-collapsible-body>\n                    ${this.renderModeConfig(mode)}\n                  </effortlesshome-collapsible-body>\n                </effortlesshome-collapsible-item>\n              `;\n        })}\n        </effortlesshome-collapsible-group>\n      </ha-card>\n    `;\n    }\n    getSensorsByMode(mode) {\n        return Object.values(this.sensors).filter(e => e.area == this.selectedArea && (e.modes.includes(mode) || e.always_on)).length;\n    }\n    renderModeConfig(mode) {\n        const config = mode in this.data ? this.data[mode] : undefined;\n        return html `\n      <div class=\"description\">\n        <ha-icon icon=\"mdi:information-outline\"></ha-icon>\n        ${localize(`panels.general.cards.modes.modes.${mode}`, this.hass.language)}\n      </div>\n      <settings-row .narrow=${this.narrow}>\n        <span slot=\"heading\">\n          ${localize('panels.general.cards.modes.fields.status.heading', this.hass.language)}\n        </span>\n        <span slot=\"description\">\n          ${localize('panels.general.cards.modes.fields.status.description', this.hass.language)}\n        </span>\n        <div>\n          <mwc-button class=\"${(config === null || config === void 0 ? void 0 : config.enabled) ? 'active' : ''}\" @click=${() => this.saveData(mode, { enabled: true })}>\n            <ha-icon icon=\"mdi:check\"></ha-icon>\n            ${localize('common.enabled', this.hass.language)}\n          </mwc-button>\n          <mwc-button\n            class=\"${(config === null || config === void 0 ? void 0 : config.enabled) ? '' : 'active'}\"\n            @click=${() => this.saveData(mode, { enabled: false })}\n          >\n            <ha-icon icon=\"mdi:close\"></ha-icon>\n            ${localize('common.disabled', this.hass.language)}\n          </mwc-button>\n        </div>\n      </settings-row>\n      <settings-row .narrow=${this.narrow}>\n        <span slot=\"heading\">\n          ${localize('panels.general.cards.modes.fields.exit_delay.heading', this.hass.language)}\n        </span>\n        <span slot=\"description\">\n          ${localize('panels.general.cards.modes.fields.exit_delay.description', this.hass.language)}\n        </span>\n        <time-slider\n          .hass=${this.hass}\n          max=\"300\"\n          zeroValue=${localize('components.time_slider.none', this.hass.language)}\n          value=${(config === null || config === void 0 ? void 0 : config.exit_time) || 0}\n          @value-changed=${(ev) => this.saveData(mode, {\n            exit_time: ev.detail.value,\n        })}\n          ?disabled=${!(config === null || config === void 0 ? void 0 : config.enabled)}\n        ></time-slider>\n      </settings-row>\n      <settings-row .narrow=${this.narrow}>\n        <span slot=\"heading\">\n          ${localize('panels.general.cards.modes.fields.entry_delay.heading', this.hass.language)}\n        </span>\n        <span slot=\"description\">\n          ${localize('panels.general.cards.modes.fields.entry_delay.description', this.hass.language)}\n        </span>\n        <time-slider\n          .hass=${this.hass}\n          max=\"300\"\n          zeroValue=${localize('components.time_slider.none', this.hass.language)}\n          value=${(config === null || config === void 0 ? void 0 : config.entry_time) || 0}\n          @value-changed=${(ev) => this.saveData(mode, {\n            entry_time: ev.detail.value,\n        })}\n          ?disabled=${!(config === null || config === void 0 ? void 0 : config.enabled)}\n        ></time-slider>\n      </settings-row>\n      <settings-row .narrow=${this.narrow}>\n        <span slot=\"heading\">\n          ${localize('panels.general.cards.modes.fields.trigger_time.heading', this.hass.language)}\n        </span>\n        <span slot=\"description\">\n          ${localize('panels.general.cards.modes.fields.trigger_time.description', this.hass.language)}\n        </span>\n        <time-slider\n          .hass=${this.hass}\n          max=\"3600\"\n          step=\"60\"\n          zeroValue=${localize('components.time_slider.infinite', this.hass.language)}\n          value=${(config === null || config === void 0 ? void 0 : config.trigger_time) || 0}\n          @value-changed=${(ev) => this.saveData(mode, {\n            trigger_time: ev.detail.value,\n        })}\n          ?disabled=${!(config === null || config === void 0 ? void 0 : config.enabled)}\n        ></time-slider>\n      </settings-row>\n    `;\n    }\n    selectArea(area_id) {\n        if (area_id == this.selectedArea)\n            return;\n        this.selectedArea = area_id;\n        this.data = Object.assign({}, this.areas[area_id].modes);\n    }\n    saveClick(ev) {\n        saveArea(this.hass, { area_id: this.selectedArea, modes: this.data })\n            .catch(e => handleError(e, ev))\n            .then();\n    }\n    saveData(mode, update) {\n        const DefaultMode = {\n            enabled: false,\n            exit_time: 0,\n            entry_time: 0,\n            trigger_time: 0,\n        };\n        this.data = Object.assign(Object.assign({}, this.data), { [mode]: Object.assign(Object.assign({}, (this.data[mode] || DefaultMode)), update) });\n        saveArea(this.hass, { area_id: this.selectedArea, modes: this.data })\n            .catch(e => handleError(e, this.shadowRoot.querySelector('ha-card')))\n            .then();\n    }\n    static get styles() {\n        return css `\n      ${commonStyle}\n      effortlesshome-collapsible-header:first-of-type {\n        border-top: 1px solid var(--divider-color);\n      }\n      .description {\n        margin: 8px;\n        padding: 12px;\n        color: var(--primary-color);\n        filter: brightness(0.85);\n        font-size: 14px;\n        line-height: 1.5em;\n        min-height: 36px;\n        display: flex;\n        align-items: center;\n        position: relative;\n      }\n      .description::before {\n        position: absolute;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        left: 0;\n        pointer-events: none;\n        content: '';\n        background: rgba(var(--rgb-primary-color), 0.12);\n        border-radius: 5px;\n      }\n      .description ha-icon {\n        --mdc-icon-size: 36px;\n        display: inline;\n        float: left;\n        margin-right: 12px;\n        align-self: flex-start;\n      }\n    `;\n    }\n};\n__decorate([\n    property()\n], AlarmModeCard.prototype, \"hass\", void 0);\n__decorate([\n    property({ type: Boolean })\n], AlarmModeCard.prototype, \"narrow\", void 0);\n__decorate([\n    property()\n], AlarmModeCard.prototype, \"config\", void 0);\n__decorate([\n    property()\n], AlarmModeCard.prototype, \"areas\", void 0);\n__decorate([\n    property()\n], AlarmModeCard.prototype, \"sensors\", void 0);\n__decorate([\n    property()\n], AlarmModeCard.prototype, \"data\", void 0);\n__decorate([\n    property()\n], AlarmModeCard.prototype, \"selectedArea\", void 0);\nAlarmModeCard = __decorate([\n    customElement('alarm-mode-card')\n], AlarmModeCard);\nexport { AlarmModeCard };\n","references":["/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/index.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/decorators.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/home-assistant-js-websocket/dist/index.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/styles.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/localize/localize.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/types.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/data/websockets.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/helpers.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/subscribe-mixin.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/const.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/components/time-slider.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/components/effortlesshome-select.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/components/effortlesshome-collapsible.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/common/navigation.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/components/time-slider.ts"]}
