{"code":"import { __decorate } from \"tslib\";\nimport { LitElement, html } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\nimport { fetchConfig, saveConfig, fetchAreas, fetchAutomations, deleteAutomation } from '../../data/websockets';\nimport { SubscribeMixin } from '../../subscribe-mixin';\nimport { localize } from '../../../localize/localize';\nimport { pick, handleError, navigate } from '../../helpers';\nimport { loadHaForm } from '../../load-ha-elements';\nimport { commonStyle } from '../../styles';\nimport { exportPath } from '../../common/navigation';\nimport './alarm-mode-card';\nimport './mqtt-config-card.ts';\nimport './area-config-card.ts';\nimport '../../components/settings-row.ts';\nimport '../../dialogs/edit-master-dialog.ts';\nimport '../../dialogs/confirm-delete-dialog.ts';\nimport { fireEvent } from '../../fire_event';\nlet AlarmViewGeneral = class AlarmViewGeneral extends SubscribeMixin(LitElement) {\n    constructor() {\n        super(...arguments);\n        this.areas = {};\n        this.automations = {};\n    }\n    hassSubscribe() {\n        this._fetchData();\n        return [this.hass.connection.subscribeMessage(() => this._fetchData(), { type: 'effortlesshome_config_updated' })];\n    }\n    async _fetchData() {\n        if (!this.hass) {\n            return;\n        }\n        this.config = await fetchConfig(this.hass);\n        this.areas = await fetchAreas(this.hass);\n        this.automations = await fetchAutomations(this.hass);\n        this.data = pick(this.config, ['trigger_time', 'disarm_after_trigger', 'mqtt', 'master']);\n    }\n    firstUpdated() {\n        (async () => await loadHaForm())();\n    }\n    render() {\n        var _a, _b, _c, _d, _e, _f, _g, _h;\n        if (!this.hass || !this.config || !this.data)\n            return html ``;\n        if (this.path.subpage == 'mqtt_configuration') {\n            return html `\n        <mqtt-config-card .hass=${this.hass} .narrow=${this.narrow}></mqtt-config-card>\n      `;\n        }\n        if (this.path.params.edit_area) {\n            return html `\n        <area-editor-card\n          .hass=${this.hass}\n          .narrow=${this.narrow}\n          item=${this.path.params.edit_area}\n        ></area-editor-card>\n      `;\n        }\n        else {\n            return html `\n        <ha-card header=\"${localize('panels.general.title', this.hass.language)}\">\n          <div class=\"card-content\">\n            ${localize('panels.general.cards.general.description', this.hass.language)}\n          </div>\n\n          <settings-row .narrow=${this.narrow}>\n            <span slot=\"heading\">\n              ${localize('panels.general.cards.general.fields.disarm_after_trigger.heading', this.hass.language)}\n            </span>\n            <span slot=\"description\">\n              ${localize('panels.general.cards.general.fields.disarm_after_trigger.description', this.hass.language)}\n            </span>\n            <ha-switch\n              ?checked=${this.data.disarm_after_trigger}\n              @change=${(ev) => {\n                this.saveData({ disarm_after_trigger: ev.target.checked });\n            }}\n            ></ha-switch>\n          </settings-row>\n\n          <settings-row .narrow=${this.narrow}>\n            <span slot=\"heading\">\n              ${localize('panels.general.cards.general.fields.enable_mqtt.heading', this.hass.language)}\n            </span>\n            <span slot=\"description\">\n              ${localize('panels.general.cards.general.fields.enable_mqtt.description', this.hass.language)}\n            </span>\n            <ha-switch\n              ?checked=${(_b = (_a = this.data) === null || _a === void 0 ? void 0 : _a.mqtt) === null || _b === void 0 ? void 0 : _b.enabled}\n              @change=${(ev) => {\n                this.saveData({ mqtt: Object.assign(Object.assign({}, this.data.mqtt), { enabled: ev.target.checked }) });\n            }}\n            ></ha-switch>\n          </settings-row>\n\n          ${((_d = (_c = this.data) === null || _c === void 0 ? void 0 : _c.mqtt) === null || _d === void 0 ? void 0 : _d.enabled)\n                ? html `\n                <div style=\"padding: 0px 0px 16px 16px\">\n                  <mwc-button\n                    outlined\n                    @click=${() => navigate(this, exportPath('general', 'mqtt_configuration'), true)}\n                  >\n                    ${localize('panels.general.cards.general.actions.setup_mqtt', this.hass.language)}\n                  </mwc-button>\n                </div>\n              `\n                : ''}\n          ${Object.keys(this.areas).length >= 2\n                ? html `\n                <settings-row .narrow=${this.narrow}>\n                  <span slot=\"heading\">\n                    ${localize('panels.general.cards.general.fields.enable_master.heading', this.hass.language)}\n                  </span>\n                  <span slot=\"description\">\n                    ${localize('panels.general.cards.general.fields.enable_master.description', this.hass.language)}\n                  </span>\n                  <ha-switch\n                    ?checked=${((_f = (_e = this.data) === null || _e === void 0 ? void 0 : _e.master) === null || _f === void 0 ? void 0 : _f.enabled) && Object.keys(this.areas).length >= 2}\n                    ?disabled=${Object.keys(this.areas).length < 2}\n                    @change=${this.toggleEnableMaster}\n                  ></ha-switch>\n                </settings-row>\n              `\n                : ''}\n          ${((_h = (_g = this.data) === null || _g === void 0 ? void 0 : _g.master) === null || _h === void 0 ? void 0 : _h.enabled) && Object.keys(this.areas).length >= 2\n                ? html `\n                <div style=\"padding: 0px 0px 16px 16px\">\n                  <mwc-button outlined @click=${this.setupMasterClick}>\n                    ${localize('panels.general.cards.general.actions.setup_master', this.hass.language)}\n                  </mwc-button>\n                </div>\n              `\n                : ''}\n        </ha-card>\n\n        <alarm-mode-card .hass=${this.hass} .narrow=${this.narrow}></alarm-mode-card>\n\n        <area-config-card .hass=${this.hass} .narrow=${this.narrow}></area-config-card>\n      `;\n        }\n    }\n    setupMasterClick(ev) {\n        const element = ev.target;\n        fireEvent(element, 'show-dialog', {\n            dialogTag: 'edit-master-dialog',\n            dialogImport: () => import('../../dialogs/edit-master-dialog'),\n            dialogParams: {},\n        });\n    }\n    async toggleEnableMaster(ev) {\n        const target = ev.target;\n        let enabled = target.checked;\n        if (!enabled) {\n            const automations = Object.values(this.automations).filter(e => e.triggers.some(e => !e.area));\n            if (automations.length) {\n                const result = await new Promise(resolve => {\n                    fireEvent(target, 'show-dialog', {\n                        dialogTag: 'confirm-delete-dialog',\n                        dialogImport: () => import('../../dialogs/confirm-delete-dialog'),\n                        dialogParams: {\n                            title: localize('panels.general.dialogs.disable_master.title', this.hass.language),\n                            description: localize('panels.general.dialogs.disable_master.description', this.hass.language, 'automations', String(automations.length)),\n                            cancel: () => resolve(false),\n                            confirm: () => resolve(true),\n                        },\n                    });\n                });\n                if (!result) {\n                    enabled = true;\n                    target.checked = true;\n                }\n                else if (!enabled && automations.length) {\n                    automations.forEach(e => {\n                        deleteAutomation(this.hass, e.automation_id).catch(e => handleError(e, ev));\n                    });\n                }\n            }\n        }\n        this.saveData({ master: Object.assign(Object.assign({}, this.data.master), { enabled: enabled }) });\n    }\n    saveData(changes) {\n        if (!this.hass || !this.data)\n            return;\n        this.data = Object.assign(Object.assign({}, this.data), changes);\n        saveConfig(this.hass, this.data)\n            .catch(e => handleError(e, this.shadowRoot.querySelector('ha-card')))\n            .then();\n    }\n};\nAlarmViewGeneral.styles = commonStyle;\n__decorate([\n    property()\n], AlarmViewGeneral.prototype, \"narrow\", void 0);\n__decorate([\n    property()\n], AlarmViewGeneral.prototype, \"path\", void 0);\n__decorate([\n    property()\n], AlarmViewGeneral.prototype, \"data\", void 0);\n__decorate([\n    property()\n], AlarmViewGeneral.prototype, \"config\", void 0);\n__decorate([\n    property()\n], AlarmViewGeneral.prototype, \"areas\", void 0);\n__decorate([\n    property()\n], AlarmViewGeneral.prototype, \"automations\", void 0);\nAlarmViewGeneral = __decorate([\n    customElement('alarm-view-general')\n], AlarmViewGeneral);\nexport { AlarmViewGeneral };\n","references":["/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/index.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/decorators.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/home-assistant-js-websocket/dist/index.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/data/websockets.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/subscribe-mixin.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/localize/localize.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/helpers.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/load-ha-elements.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/types.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/styles.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/common/navigation.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/views/general/alarm-mode-card.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/views/general/mqtt-config-card.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/views/general/area-config-card.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/components/settings-row.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/dialogs/edit-master-dialog.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/dialogs/confirm-delete-dialog.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/fire_event.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/dialogs/edit-master-dialog.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/dialogs/confirm-delete-dialog.ts"]}
