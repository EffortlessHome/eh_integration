{"code":"import { __decorate } from \"tslib\";\r\nimport { mdiFilterVariant, mdiClose } from '@mdi/js';\r\nimport { LitElement, html, css } from 'lit';\r\nimport { property, customElement, state, query } from 'lit/decorators.js';\r\nimport { localize } from '../../localize/localize';\r\nimport './effortlesshome-chip-set';\r\nimport { omit, pick } from '../helpers';\r\nlet effortlesshomeTable = class effortlesshomeTable extends LitElement {\r\n    set filters(data) {\r\n        if (this.filterConfig)\r\n            return;\r\n        this.filterConfig = data;\r\n    }\r\n    shouldUpdate(changedProps) {\r\n        if (changedProps.get('filters') && !this.filterConfig) {\r\n            this.filterConfig = changedProps.get('filters');\r\n        }\r\n        return true;\r\n    }\r\n    render() {\r\n        if (!this.columns || !this.data)\r\n            return html ``;\r\n        const filteredData = this.data.filter(e => this.filterTableData(e, this.filterConfig));\r\n        return html `\n      ${this.renderFilterRow()}\n      <div class=\"table\">\n        ${this.renderHeaderRow()}\n        ${filteredData.length\r\n            ? filteredData.map(e => this.renderDataRow(e))\r\n            : html `\n              <div class=\"table-row\">\n                <div class=\"table-cell text grow\">\n                  <slot></slot>\n                </div>\n              </div>\n            `}\n      </div>\n    `;\r\n    }\r\n    renderHeaderRow() {\r\n        if (!this.columns)\r\n            return html ``;\r\n        return html `\n      <div class=\"table-row header\">\n        ${Object.values(this.columns).map(e => e.hide\r\n            ? ''\r\n            : html `\n                <div\n                  class=\"table-cell ${e.text ? 'text' : ''} ${e.grow ? 'grow' : ''} ${e.align ? e.align : ''}\"\n                  style=\"${e.grow ? '' : `width: ${e.width}`}\"\n                >\n                  <span>${e.title || ''}</span>\n                </div>\n              `)}\n      </div>\n    `;\r\n    }\r\n    renderDataRow(data) {\r\n        if (!this.columns)\r\n            return html ``;\r\n        return html `\n      <div\n        class=\"table-row ${this.selectable ? 'selectable' : ''} ${data.warning ? 'warning' : ''}\"\n        @click=${() => this.handleClick(String(data.id))}\n      >\n        ${Object.entries(this.columns).map(([col, e]) => e.hide\r\n            ? ''\r\n            : html `\n                <div\n                  class=\"table-cell ${e.text ? 'text' : ''} ${e.grow ? 'grow' : ''} ${e.align ? e.align : ''}\"\n                  style=\"${e.grow ? '' : `width: ${e.width}`}\"\n                >\n                  ${e.renderer ? e.renderer(data) : data[col]}\n                </div>\n              `)}\n      </div>\n    `;\r\n    }\r\n    filterTableData(data, filterConfig) {\r\n        if (!filterConfig)\r\n            return true;\r\n        return Object.keys(filterConfig).every(key => {\r\n            if (!Object.keys(data).includes(key))\r\n                return true;\r\n            const filterValue = filterConfig[key].value;\r\n            if (!filterValue || !filterValue.length)\r\n                return true;\r\n            if (Array.isArray(data[key]))\r\n                return data[key].some(e => filterValue.includes(e));\r\n            return filterValue.includes(data[key]);\r\n        });\r\n    }\r\n    _getFilteredItems() {\r\n        return this.data.filter(e => !this.filterTableData(e, this.filterConfig)).length;\r\n    }\r\n    handleClick(id) {\r\n        if (!this.selectable)\r\n            return;\r\n        const myEvent = new CustomEvent('row-click', { detail: { id: id } });\r\n        this.dispatchEvent(myEvent);\r\n    }\r\n    renderFilterRow() {\r\n        var _a;\r\n        if (!this.filterConfig)\r\n            return html ``;\r\n        return html `\n      <div class=\"table-filter\">\n        <ha-icon-button\n          .path=${mdiFilterVariant}\n          ?disabled=${!((_a = this.data) === null || _a === void 0 ? void 0 : _a.length)}\n          label=${localize('components.table.filter.label', this.hass.language)}\n          @click=${this._toggleFilterMenu}\n        ></ha-icon-button>\n        <mwc-menu .corner=${'BOTTOM_START'} .fixed=${true} @closed=${this._applyFilterSelection}>\n          ${this.renderFilterMenu()}\n        </mwc-menu>\n\n        ${this._getFilteredItems()\r\n            ? html `\n              <effortlesshome-chip cancellable table @button-clicked=${this._clearFilters}>\n                ${localize('components.table.filter.hidden_items', this.hass.language, 'number', this._getFilteredItems())}\n              </effortlesshome-chip>\n            `\r\n            : ''}\n      </div>\n    `;\r\n    }\r\n    _toggleFilterMenu(ev) {\r\n        const el = ev.target;\r\n        this._menu.anchor = el;\r\n        if (this._menu.open)\r\n            this._menu.close();\r\n        else {\r\n            this.filterSelection = Object.entries(this.filterConfig).reduce((acc, [k, v]) => (Object.assign(Object.assign({}, acc), { [k]: pick(v, ['value']) })), {});\r\n            this._menu.show();\r\n        }\r\n    }\r\n    renderFilterMenu() {\r\n        if (!this.filterConfig || !this.filterSelection)\r\n            return html ``;\r\n        return html `\n      <span class=\"header\">\n        ${localize('components.table.filter.label', this.hass.language)}\n      </span>\n      <ha-icon-button\n        .path=${mdiClose}\n        @click=${() => {\r\n            this._menu.close();\r\n            setTimeout(() => this._menu.anchor.blur(), 50);\r\n        }}\n      ></ha-icon-button>\n      ${Object.keys(this.filterConfig).map(key => {\r\n            if (this.filterConfig[key].binary) {\r\n                return html `\n            <div class=\"dropdown-item checkbox\">\n              <ha-checkbox\n                @change=${(ev) => this._updateFilterSelection(key, ev.target.checked)}\n                ?checked=${this.filterSelection[key].value.length}\n              ></ha-checkbox>\n              <span class=\"name\">\n                ${this.filterConfig[key].name}\n              </span>\n            </div>\n          `;\r\n            }\r\n            let items = this.filterConfig[key].items;\r\n            items = items.map(e => {\r\n                var _a;\r\n                if (e.badge && typeof e.badge == 'function')\r\n                    return {\r\n                        ...e,\r\n                        badge: e.badge((_a = this.data) === null || _a === void 0 ? void 0 : _a.filter(a => this.filterTableData(a, omit(this.filterSelection, key)))),\r\n                    };\r\n                else\r\n                    return e;\r\n            });\r\n            const value = this.filterSelection[key].value;\r\n            return html `\n          <div class=\"dropdown-item\">\n            <span class=\"name\">\n              ${this.filterConfig[key].name}\n            </span>\n            <effortlesshome-chip-set\n              selectable\n              .items=${items}\n              @value-changed=${(ev) => this._updateFilterSelection(key, ev.detail)}\n              .value=${value}\n            ></effortlesshome-chip-set>\n          </div>\n        `;\r\n        })}\n    `;\r\n    }\r\n    _updateFilterSelection(key, value) {\r\n        if (typeof value == 'boolean') {\r\n            value = (value ? this.filterConfig[key].items[0].value : []);\r\n            if (Object.keys(this.filterConfig).length == 1) {\r\n                this._menu.close();\r\n                setTimeout(() => this._menu.anchor.blur(), 50);\r\n            }\r\n        }\r\n        this.filterSelection = Object.assign(Object.assign({}, this.filterSelection), { [key]: { value: value } });\r\n    }\r\n    _clearFilters() {\r\n        Object.keys(this.filterConfig).forEach(key => {\r\n            this.filterConfig = Object.assign(Object.assign({}, this.filterConfig), { [key]: Object.assign(Object.assign({}, this.filterConfig[key]), { value: [] }) });\r\n        });\r\n    }\r\n    _applyFilterSelection() {\r\n        Object.keys(this.filterConfig).forEach(key => {\r\n            this.filterConfig = Object.assign(Object.assign({}, this.filterConfig), { [key]: Object.assign(Object.assign({}, this.filterConfig[key]), this.filterSelection[key]) });\r\n        });\r\n    }\r\n};\r\neffortlesshomeTable.styles = css `\n    :host {\n      width: 100%;\n    }\n    div.table {\n      display: inline-flex;\n      flex-direction: column;\n      box-sizing: border-box;\n      width: 100%;\n    }\n    div.table .header {\n      font-weight: bold;\n    }\n    div.table-row {\n      display: flex;\n      width: 100%;\n      height: 52px;\n      border-top: 1px solid var(--divider-color);\n      flex-direction: row;\n      position: relative;\n    }\n    div.table-cell {\n      align-self: center;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      flex-shrink: 0;\n      box-sizing: border-box;\n    }\n    div.table-cell.text {\n      padding: 4px 16px;\n    }\n    div.table-cell.grow {\n      flex-grow: 1;\n      flex-shrink: 1;\n    }\n\n    div.table-cell > ha-switch {\n      width: 68px;\n      height: 48px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    div.table-cell.center {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    div.table-cell.right {\n      display: flex;\n      align-items: center;\n      justify-content: flex-end;\n    }\n\n    div.table-cell > ha-icon-button {\n      color: var(--secondary-text-color);\n    }\n    div.table-cell > * {\n      transition: color 0.2s ease-in-out;\n    }\n    div.table .header div.table-cell span {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      min-width: 0;\n    }\n    div.table-row.selectable {\n      cursor: pointer;\n    }\n    .table-row::before {\n      position: absolute;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n      opacity: 0.12;\n      pointer-events: none;\n      content: '';\n      border-radius: 4px;\n    }\n    div.table-row.selectable:hover::before {\n      background-color: rgba(var(--rgb-primary-text-color), 0.5);\n    }\n    div.table-row.warning::before {\n      background-color: var(--error-color);\n      opacity: 0.06;\n    }\n    div.table-row.warning:hover::before {\n      background-color: var(--error-color);\n      opacity: 0.12;\n    }\n    div.table-row.warning span {\n      color: var(--error-color);\n    }\n\n    ha-icon {\n      color: var(--state-icon-color);\n      padding: 8px;\n    }\n\n    .secondary {\n      color: var(--secondary-text-color);\n      display: flex;\n      padding-top: 4px;\n    }\n\n    a,\n    a:visited {\n      color: var(--primary-color);\n    }\n\n    span.disabled {\n      color: var(--secondary-text-color);\n    }\n    span.secondary.disabled {\n      color: var(--disabled-text-color);\n    }\n    ha-icon.disabled {\n      color: var(--state-unavailable-color);\n    }\n\n    div.table-filter {\n      display: flex;\n      width: 100%;\n      min-height: 52px;\n      border-top: 1px solid var(--divider-color);\n      box-sizing: border-box;\n      padding: 2px 8px;\n      flex: 1;\n      position: relative;\n      flex-direction: row;\n      align-items: center;\n    }\n    mwc-menu .header {\n      display: flex;\n      padding: 8px 16px;\n      font-weight: bold;\n    }\n    mwc-menu ha-icon-button {\n      position: absolute;\n      top: 8px;\n      right: 8px;\n    }\n    div.dropdown-item {\n      display: flex;\n      flex-direction: column;\n      flex-shrink: 0;\n      padding: 8px 16px;\n      width: 100%;\n      min-height: 52px;\n      box-sizing: border-box;\n    }\n    div.dropdown-item .name {\n      display: inline-flex;\n    }\n    div.dropdown-item effortlesshome-chips {\n      display: flex;\n      flex-direction: row;\n    }\n    div.dropdown-item.checkbox {\n      flex-direction: row;\n      align-items: center;\n    }\n    ha-button-menu mwc-button {\n      margin-left: 16px;\n    }\n  `;\r\n__decorate([\r\n    property()\r\n], effortlesshomeTable.prototype, \"hass\", void 0);\r\n__decorate([\r\n    property()\r\n], effortlesshomeTable.prototype, \"columns\", void 0);\r\n__decorate([\r\n    property()\r\n], effortlesshomeTable.prototype, \"data\", void 0);\r\n__decorate([\r\n    state()\r\n], effortlesshomeTable.prototype, \"filterConfig\", void 0);\r\n__decorate([\r\n    state()\r\n], effortlesshomeTable.prototype, \"filterSelection\", void 0);\r\n__decorate([\r\n    property({ type: Boolean })\r\n], effortlesshomeTable.prototype, \"selectable\", void 0);\r\n__decorate([\r\n    query('mwc-menu', true)\r\n], effortlesshomeTable.prototype, \"_menu\", void 0);\r\neffortlesshomeTable = __decorate([\r\n    customElement('effortlesshome-table')\r\n], effortlesshomeTable);\r\nexport { effortlesshomeTable };\r\n","references":["/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/@mdi/js/mdi.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/index.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/decorators.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/types.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/localize/localize.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/components/effortlesshome-chip-set.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/helpers.ts"]}
