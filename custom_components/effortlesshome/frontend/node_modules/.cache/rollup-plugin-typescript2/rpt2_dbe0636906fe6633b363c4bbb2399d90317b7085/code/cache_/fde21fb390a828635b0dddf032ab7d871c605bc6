{"code":"import { __decorate } from \"tslib\";\r\nimport { LitElement, html } from 'lit';\r\nimport { property, customElement } from 'lit/decorators.js';\r\nimport { prettyPrint, handleError, sortAlphabetically, pick, navigate } from '../../helpers';\r\nimport './user-editor-card.ts';\r\nimport '../../components/settings-row.ts';\r\nimport '../../components/effortlesshome-table.ts';\r\nimport { commonStyle } from '../../styles';\r\nimport { localize } from '../../../localize/localize';\r\nimport { SubscribeMixin } from '../../subscribe-mixin';\r\nimport { fetchConfig, fetchUsers, saveConfig, saveUser } from '../../data/websockets';\r\nimport { exportPath } from '../../common/navigation';\r\nlet AlarmViewCodes = class AlarmViewCodes extends SubscribeMixin(LitElement) {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.users = {};\r\n    }\r\n    hassSubscribe() {\r\n        this._fetchData();\r\n        return [this.hass.connection.subscribeMessage(() => this._fetchData(), { type: 'effortlesshome_config_updated' })];\r\n    }\r\n    async _fetchData() {\r\n        if (!this.hass) {\r\n            return;\r\n        }\r\n        const config = await fetchConfig(this.hass);\r\n        this.data = pick(config, ['code_arm_required', 'code_disarm_required', 'code_mode_change_required', 'code_format']);\r\n        const users = await fetchUsers(this.hass);\r\n        this.users = users;\r\n    }\r\n    render() {\r\n        if (!this.hass || !this.data)\r\n            return html ``;\r\n        if (this.path.subpage == 'new_user') {\r\n            return html `\n        <user-editor-card .hass=${this.hass} .narrow=${this.narrow}></user-editor-card>\n      `;\r\n        }\r\n        else if (this.path.params.edit_user) {\r\n            return html `\n        <user-editor-card\n          .hass=${this.hass}\n          .narrow=${this.narrow}\n          item=${this.path.params.edit_user}\n        ></user-editor-card>\n      `;\r\n        }\r\n        else {\r\n            const codesInUse = this.data.code_arm_required || this.data.code_disarm_required || this.data.code_mode_change_required;\r\n            return html `\n        <ha-card header=\"${localize('panels.codes.title', this.hass.language)}\">\n          <div class=\"card-content\">${localize('panels.codes.cards.codes.description', this.hass.language)}</div>\n\n          <settings-row .narrow=${this.narrow}>\n            <span slot=\"heading\">\n              ${localize('panels.codes.cards.codes.fields.code_arm_required.heading', this.hass.language)}\n            </span>\n            <span slot=\"description\">\n              ${localize('panels.codes.cards.codes.fields.code_arm_required.description', this.hass.language)}\n            </span>\n            <ha-switch\n              ?checked=${this.data.code_arm_required}\n              @change=${(ev) => {\r\n                this.saveData({ code_arm_required: ev.target.checked });\r\n            }}\n            ></ha-switch>\n          </settings-row>\n\n          <settings-row .narrow=${this.narrow}>\n            <span slot=\"heading\">\n              ${localize('panels.codes.cards.codes.fields.code_disarm_required.heading', this.hass.language)}\n            </span>\n            <span slot=\"description\">\n              ${localize('panels.codes.cards.codes.fields.code_disarm_required.description', this.hass.language)}\n            </span>\n            <ha-switch\n              ?checked=${this.data.code_disarm_required}\n              @change=${(ev) => {\r\n                this.saveData({ code_disarm_required: ev.target.checked });\r\n            }}\n            ></ha-switch>\n          </settings-row>\n\n          <settings-row .narrow=${this.narrow}>\n            <span slot=\"heading\">\n              ${localize('panels.codes.cards.codes.fields.code_mode_change_required.heading', this.hass.language)}\n            </span>\n            <span slot=\"description\">\n              ${localize('panels.codes.cards.codes.fields.code_mode_change_required.description', this.hass.language)}\n            </span>\n            <ha-switch\n              ?checked=${this.data.code_mode_change_required}\n              @change=${(ev) => {\r\n                this.saveData({ code_mode_change_required: ev.target.checked });\r\n            }}\n            ></ha-switch>\n          </settings-row>\n\n          <settings-row .narrow=${this.narrow}>\n            <span slot=\"heading\">\n              ${localize('panels.codes.cards.codes.fields.code_format.heading', this.hass.language)}\n            </span>\n            <span slot=\"description\">\n              ${localize('panels.codes.cards.codes.fields.code_format.description', this.hass.language)}\n            </span>\n            <mwc-button\n              class=\"${this.data.code_format == 'number' ? 'active' : ''} ${!codesInUse\r\n                ? 'disabled'\r\n                : ''}\"\n              @click=${() => {\r\n                this.saveData({ code_format: 'number' });\r\n            }}\n              ?disabled=${!codesInUse}\n            >\n              ${localize('panels.codes.cards.codes.fields.code_format.code_format_number', this.hass.language)}\n            </mwc-button>\n            <mwc-button\n              class=\"${this.data.code_format == 'text' ? 'active' : ''} ${!codesInUse\r\n                ? 'disabled'\r\n                : ''}\"\n              @click=${() => {\r\n                this.saveData({ code_format: 'text' });\r\n            }}\n              ?disabled=${!codesInUse}\n            >\n              ${localize('panels.codes.cards.codes.fields.code_format.code_format_text', this.hass.language)}\n            </mwc-button>\n          </settings-row>\n        </ha-card>\n\n        ${this.usersPanel()}\n      `;\r\n        }\r\n    }\r\n    usersPanel() {\r\n        if (!this.hass)\r\n            return html ``;\r\n        const users = Object.values(this.users);\r\n        users.sort(sortAlphabetically);\r\n        const columns = {\r\n            icon: {\r\n                width: '40px',\r\n            },\r\n            name: {\r\n                title: this.hass.localize('ui.components.area-picker.add_dialog.name'),\r\n                width: '40%',\r\n                grow: true,\r\n                text: true,\r\n            },\r\n            code_format: {\r\n                title: localize('panels.codes.cards.codes.fields.code_format.heading', this.hass.language),\r\n                width: '40%',\r\n                hide: this.narrow,\r\n                text: true,\r\n            },\r\n            enabled: {\r\n                title: localize('common.enabled', this.hass.language),\r\n                width: '68px',\r\n                align: 'center',\r\n            },\r\n        };\r\n        const data = users.map(item => {\r\n            const output = {\r\n                id: item.user_id,\r\n                icon: html `\n          <ha-icon icon=\"mdi:account-outline\"></ha-icon>\n        `,\r\n                name: prettyPrint(item.name),\r\n                code_format: item.code_format == 'number'\r\n                    ? prettyPrint(localize('panels.codes.cards.codes.fields.code_format.code_format_number', this.hass.language))\r\n                    : item.code_format == 'text'\r\n                        ? prettyPrint(localize('panels.codes.cards.codes.fields.code_format.code_format_text', this.hass.language))\r\n                        : this.hass.localize('state.default.unknown'),\r\n                enabled: html `\n          <ha-switch\n            @click=${(ev) => {\r\n                    ev.stopPropagation();\r\n                }}\n            ?checked=${item.enabled}\n            @change=${(ev) => this.toggleEnabled(ev, item.user_id)}\n          ></ha-switch>\n        `,\r\n            };\r\n            return output;\r\n        });\r\n        return html `\n      <ha-card header=\"${localize('panels.codes.cards.user_management.title', this.hass.language)}\">\n        <div class=\"card-content\">\n          ${localize('panels.codes.cards.user_management.description', this.hass.language)}\n        </div>\n\n        <effortlesshome-table\n          ?selectable=${true}\n          .columns=${columns}\n          .data=${data}\n          @row-click=${(ev) => {\r\n            const id = String(ev.detail.id);\r\n            navigate(this, exportPath('codes', { params: { edit_user: id } }), true);\r\n        }}\n        >\n          ${localize('panels.codes.cards.user_management.no_items', this.hass.language)}\n        </effortlesshome-table>\n        <div class=\"card-actions\">\n          <mwc-button @click=${this.addUserClick}>\n            ${localize('panels.codes.cards.user_management.actions.new_user', this.hass.language)}\n          </mwc-button>\n        </div>\n      </ha-card>\n    `;\r\n    }\r\n    addUserClick() {\r\n        navigate(this, exportPath('codes', 'new_user'), true);\r\n    }\r\n    saveData(changes) {\r\n        if (!this.hass)\r\n            return;\r\n        this.data = Object.assign(Object.assign({}, this.data), changes);\r\n        saveConfig(this.hass, this.data)\r\n            .catch(e => handleError(e, this.shadowRoot.querySelector('ha-card')))\r\n            .then();\r\n    }\r\n    toggleEnabled(ev, id) {\r\n        const enabled = ev.target.checked;\r\n        saveUser(this.hass, { user_id: id, enabled: enabled })\r\n            .catch(e => handleError(e, ev))\r\n            .then();\r\n    }\r\n};\r\nAlarmViewCodes.styles = commonStyle;\r\n__decorate([\r\n    property()\r\n], AlarmViewCodes.prototype, \"hass\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmViewCodes.prototype, \"narrow\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmViewCodes.prototype, \"path\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmViewCodes.prototype, \"data\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmViewCodes.prototype, \"users\", void 0);\r\nAlarmViewCodes = __decorate([\r\n    customElement('alarm-view-codes')\r\n], AlarmViewCodes);\r\nexport { AlarmViewCodes };\r\n","references":["/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/index.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/lit/decorators.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/helpers.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/types.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/styles.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/localize/localize.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/subscribe-mixin.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/node_modules/home-assistant-js-websocket/dist/index.d.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/data/websockets.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/components/effortlesshome-table.ts","/Users/jermiecullip/Documents/eh_integration/custom_components/effortlesshome/frontend/src/common/navigation.ts"]}
